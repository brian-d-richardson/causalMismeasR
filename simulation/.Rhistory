facet_grid(method ~ ps + out, scales = "free") +
labs(y = "Parameter Estimate",
fill = "Type",
color = "Type") +
ggtitle(paste0("Empirical Distribution of Parameter Estimates"),
subtitle = paste0(n.rep, " simulations per setting")) +
theme_bw() +
theme(axis.title.x = element_blank(),
axis.ticks.x = element_blank(),
axis.text.x = element_blank()) +
scale_fill_manual(values = pal_light) +
scale_color_manual(values = pal_dark)
}
make.plot()
tbl <- sim.out %>%
filter(n == 2000,
vare == 0.16) %>%
group_by(method, type, spec) %>%
summarise(bias = mean(est - g, na.rm = T),
emp.se = sd(est, na.rm = T),
est.se = mean(se, na.rm = T),
mse = mean((est - g.true)^2),
ci.cov = mean(ci.cov, na.rm = T))
tbl %>%
kable(digits = 3,
col.names = c("Method", "Type", "PS Model", "Outcome Model",
"Bias", "ESE", "ASE", "MSE", "CI Coverage"),
caption = "Estimated MSM Slope") %>%
kable_styling("striped")
tbl %>%
kable(digits = 3,
col.names = c("Method", "Type", "Correct Specifications",
"Bias", "ESE", "ASE", "MSE", "CI Coverage"),
caption = "Estimated MSM Slope") %>%
kable_styling("striped")
tbl <- sim.out %>%
filter(n == 2000,
vare == 0.16) %>%
group_by(method, type, spec) %>%
summarise(bias = mean(est - g, na.rm = T),
emp.se = sd(est, na.rm = T),
est.se = mean(se, na.rm = T),
ci.cov = mean(ci.cov, na.rm = T))
tbl <- sim.out %>%
filter(n == 2000,
vare == 0.16) %>%
group_by(method, type, spec) %>%
summarise(bias = mean(est - g, na.rm = T),
emp.se = sd(est, na.rm = T),
est.se = mean(se, na.rm = T),
ci.cov = mean(ci.cov, na.rm = T))
tbl %>%
kable(digits = 3,
col.names = c("Method", "Type", "Correct Specifications",
"Bias", "ESE", "ASE", "CI Coverage"),
caption = "Estimated MSM Slope") %>%
kable_styling("striped")
rm(list = ls())
library(dplyr)
library(tidyverse)
library(ggplot2)
library(ggh4x)
library(kableExtra)
library(devtools)
load_all()
# true estimand
g <- 0.75
# load simulation results from each of 10 clusters
sim.out.list <- lapply(
X = 0:9,
FUN = function(clust) {
cbind(clust,
read.csv(paste0("sim_data/dr_data/sd",
clust, ".csv")))
})
# combine simulation results into 1 data frame
sim.out <- bind_rows(sim.out.list) %>%
mutate(g.true = g,
ci.lower = est - qnorm(0.975) * se,
ci.upper = est + qnorm(0.975) * se,
ci.cov = g.true >= ci.lower & g.true <= ci.upper,
method = factor(method,
levels = c("gfmla", "ipw", "dr"),
labels = c("G-Formula", "IPW", "Doubly Robust")),
type = factor(type,
levels = c("oracle", "naive", "mccs"),
labels = c("Oracle", "Naive", "MCCS")),
spec = ifelse(ps == 0 & out == 0, "PS and OR",
ifelse(ps == 0 & out == 1, "PS",
ifelse(ps == 1 & out == 0, "OR", ""))),
ps = factor(ps,
levels = c(0, 1),
labels = c("PS Correct", "PS Incorrect")),
out = factor(out,
levels = c(0, 1),
labels = c("Outcome Correct", "Outcome Incorrect")))
# number of sims per setting
n.rep <- nrow(sim.out) /
n_distinct(dplyr::select(sim.out, method, type, ps, out, n, B, vare))
# number of sims per setting
n.rep <- nrow(sim.out) /
n_distinct(dplyr::select(sim.out, method, type, ps, out))
# summarize proportion of missing data by setting
sim.out %>%
group_by(method, type, ps, out) %>%
summarise(prop.error = mean(is.na(est))) %>%
filter(prop.error > 0) %>%
ungroup()
# colorblind friendly pallette
pal_light <- c('#EE6677', '#228833', '#4477AA', '#CCBB44', '#66CCEE', '#AA3377', '#BBBBBB')
pal_dark <- c('#991122', '#114419', '#223b55', '#6b611d', '#117799', '#55193b', '#5d5d5d')
# separate plots for each sample size
make.plot <- function() {
sim.out %>%
ggplot(aes(x = type,
y = est,
fill = type,
color = type)) +
geom_boxplot() +
geom_hline(yintercept = g,
linetype = "dashed",
color = "orange") +
facet_grid(method ~ ps + out, scales = "free") +
labs(y = "Parameter Estimate",
fill = "Type",
color = "Type") +
ggtitle(paste0("Empirical Distribution of Parameter Estimates"),
subtitle = paste0(n.rep, " simulations per setting")) +
theme_bw() +
theme(axis.title.x = element_blank(),
axis.ticks.x = element_blank(),
axis.text.x = element_blank()) +
scale_fill_manual(values = pal_light) +
scale_color_manual(values = pal_dark)
}
make.plot()
tbl <- sim.out %>%
group_by(method, type, spec) %>%
summarise(bias = mean(est - g, na.rm = T),
emp.se = sd(est, na.rm = T),
est.se = mean(se, na.rm = T),
ci.cov = mean(ci.cov, na.rm = T))
tbl %>%
kable(digits = 3,
col.names = c("Method", "Type", "Correct Specifications",
"Bias", "ESE", "ASE", "CI Coverage"),
caption = "Estimated MSM Slope") %>%
kable_styling("striped")
rm(list = ls())
library(dplyr)
library(tidyverse)
library(ggplot2)
library(ggh4x)
library(kableExtra)
library(devtools)
load_all()
# true estimand
g <- 0.75
# load simulation results from each of 10 clusters
sim.out.list <- lapply(
X = 0:9,
FUN = function(clust) {
cbind(clust,
read.csv(paste0("sim_data/dr_data/sd",
clust, ".csv")))
})
# combine simulation results into 1 data frame
sim.out <- bind_rows(sim.out.list) %>%
mutate(g.true = g,
ci.lower = est - qnorm(0.975) * se,
ci.upper = est + qnorm(0.975) * se,
ci.cov = g.true >= ci.lower & g.true <= ci.upper,
method = factor(method,
levels = c("gfmla", "ipw", "dr"),
labels = c("G-Formula", "IPW", "Doubly Robust")),
type = factor(type,
levels = c("oracle", "naive", "mccs"),
labels = c("Oracle", "Naive", "MCCS")),
spec = factor(ifelse(ps == 0 & out == 0, "PS and OR",
ifelse(ps == 0 & out == 1, "PS",
ifelse(ps == 1 & out == 0, "OR", ""))),
levels = c("PS and OR", "PS", "OR")),
ps = factor(ps,
levels = c(0, 1),
labels = c("PS Correct", "PS Incorrect")),
out = factor(out,
levels = c(0, 1),
labels = c("Outcome Correct", "Outcome Incorrect")))
# number of sims per setting
n.rep <- nrow(sim.out) /
n_distinct(dplyr::select(sim.out, method, type, ps, out))
# summarize proportion of missing data by setting
sim.out %>%
group_by(method, type, ps, out) %>%
summarise(prop.error = mean(is.na(est))) %>%
filter(prop.error > 0) %>%
ungroup()
# colorblind friendly pallette
pal_light <- c('#EE6677', '#228833', '#4477AA', '#CCBB44', '#66CCEE', '#AA3377', '#BBBBBB')
pal_dark <- c('#991122', '#114419', '#223b55', '#6b611d', '#117799', '#55193b', '#5d5d5d')
# separate plots for each sample size
make.plot <- function() {
sim.out %>%
ggplot(aes(x = type,
y = est,
fill = type,
color = type)) +
geom_boxplot() +
geom_hline(yintercept = g,
linetype = "dashed",
color = "orange") +
facet_grid(method ~ ps + out, scales = "free") +
labs(y = "Parameter Estimate",
fill = "Type",
color = "Type") +
ggtitle(paste0("Empirical Distribution of Parameter Estimates"),
subtitle = paste0(n.rep, " simulations per setting")) +
theme_bw() +
theme(axis.title.x = element_blank(),
axis.ticks.x = element_blank(),
axis.text.x = element_blank()) +
scale_fill_manual(values = pal_light) +
scale_color_manual(values = pal_dark)
}
make.plot()
tbl <- sim.out %>%
group_by(method, type, spec) %>%
summarise(bias = mean(est - g, na.rm = T),
emp.se = sd(est, na.rm = T),
est.se = mean(se, na.rm = T),
ci.cov = mean(ci.cov, na.rm = T))
tbl %>%
kable(digits = 3,
col.names = c("Method", "Type", "Correct Specifications",
"Bias", "ESE", "ASE", "CI Coverage"),
caption = "Estimated MSM Slope") %>%
kable_styling("striped")
rm(list = ls())
library(dplyr)
library(tidyverse)
library(ggplot2)
library(ggh4x)
library(kableExtra)
library(devtools)
load_all()
# true estimand
g <- 0.75
# load simulation results from each of 10 clusters
sim.out.list <- lapply(
X = 0:9,
FUN = function(clust) {
cbind(clust,
read.csv(paste0("sim_data/dr_data/sd",
clust, ".csv")))
})
# combine simulation results into 1 data frame
sim.out <- bind_rows(sim.out.list) %>%
mutate(g.true = g,
ci.lower = est - qnorm(0.975) * se,
ci.upper = est + qnorm(0.975) * se,
ci.cov = g.true >= ci.lower & g.true <= ci.upper,
method = factor(method,
levels = c("gfmla", "ipw", "dr"),
labels = c("G-Formula", "IPW", "Doubly Robust")),
type = factor(type,
levels = c("oracle", "naive", "mccs"),
labels = c("Oracle", "Naive", "MCCS")),
spec = factor(ifelse(ps == 0 & out == 0, "PS and OR",
ifelse(ps == 0 & out == 1, "PS",
ifelse(ps == 1 & out == 0, "OR", ""))),
levels = c("PS and OR", "PS", "OR", "")),
ps = factor(ps,
levels = c(0, 1),
labels = c("PS Correct", "PS Incorrect")),
out = factor(out,
levels = c(0, 1),
labels = c("Outcome Correct", "Outcome Incorrect")))
# number of sims per setting
n.rep <- nrow(sim.out) /
n_distinct(dplyr::select(sim.out, method, type, ps, out))
# summarize proportion of missing data by setting
sim.out %>%
group_by(method, type, ps, out) %>%
summarise(prop.error = mean(is.na(est))) %>%
filter(prop.error > 0) %>%
ungroup()
# colorblind friendly pallette
pal_light <- c('#EE6677', '#228833', '#4477AA', '#CCBB44', '#66CCEE', '#AA3377', '#BBBBBB')
pal_dark <- c('#991122', '#114419', '#223b55', '#6b611d', '#117799', '#55193b', '#5d5d5d')
# separate plots for each sample size
make.plot <- function() {
sim.out %>%
ggplot(aes(x = type,
y = est,
fill = type,
color = type)) +
geom_boxplot() +
geom_hline(yintercept = g,
linetype = "dashed",
color = "orange") +
facet_grid(method ~ ps + out, scales = "free") +
labs(y = "Parameter Estimate",
fill = "Type",
color = "Type") +
ggtitle(paste0("Empirical Distribution of Parameter Estimates"),
subtitle = paste0(n.rep, " simulations per setting")) +
theme_bw() +
theme(axis.title.x = element_blank(),
axis.ticks.x = element_blank(),
axis.text.x = element_blank()) +
scale_fill_manual(values = pal_light) +
scale_color_manual(values = pal_dark)
}
make.plot()
tbl <- sim.out %>%
group_by(method, type, spec) %>%
summarise(bias = mean(est - g, na.rm = T),
emp.se = sd(est, na.rm = T),
est.se = mean(se, na.rm = T),
ci.cov = mean(ci.cov, na.rm = T))
tbl %>%
kable(digits = 3,
col.names = c("Method", "Type", "Correct Specifications",
"Bias", "ESE", "ASE", "CI Coverage"),
caption = "Estimated MSM Slope") %>%
kable_styling("striped")
View(sim.out.list)
View(sim.out)
tbl2 <- sim.out %>%
filter(type == "MCCS") %>%
mutate(Estimator = paste0("CS ", method)) %>%
group_by(Estimator, spec) %>%
summarise(bias = mean(est - g, na.rm = T),
emp.se = sd(est, na.rm = T),
est.se = mean(se, na.rm = T),
ci.cov = mean(ci.cov, na.rm = T))
tbl %>%
kable(digits = 3,
col.names = c("Method", "Type", "Correct Specifications",
"Bias", "ESE", "ASE", "CI Coverage"),
caption = "Estimated MSM Slope") %>%
kable_styling("striped")
tbl %>%
kable(digits = 3,
col.names = c("Estimator", "Correct Specifications",
"Bias", "ESE", "ASE", "CI Coverage"),
caption = "Estimated MSM Slope") %>%
kable_styling("striped")
tbl2 <- sim.out %>%
filter(type == "MCCS") %>%
mutate(Estimator = paste0("CS ", method)) %>%
group_by(Estimator, spec) %>%
summarise(bias = mean(est - g, na.rm = T),
emp.se = sd(est, na.rm = T),
est.se = mean(se, na.rm = T),
ci.cov = mean(ci.cov, na.rm = T))
tbl %>%
kable(digits = 3,
col.names = c("Estimator", "Correct Specifications",
"Bias", "ESE", "ASE", "CI Coverage"),
caption = "Estimated MSM Slope") %>%
kable_styling("striped")
tbl2 %>%
kable(digits = 3,
col.names = c("Estimator", "Correct Specifications",
"Bias", "ESE", "ASE", "CI Coverage"),
caption = "Estimated MSM Slope") %>%
kable_styling("striped")
tbl2 %>%
kable(digits = 3,
col.names = c("Estimator", "Correct Specifications",
"Bias", "ESE", "ASE", "Cov"),
caption = "Estimated MSM Slope") %>%
kable_styling("striped")
View(tbl2)
tbl2 <- sim.out %>%
filter(type == "MCCS") %>%
mutate(Estimator = paste0("CS ", method)) %>%
group_by(spec, Estimator) %>%
summarise(bias = mean(est - g, na.rm = T),
emp.se = sd(est, na.rm = T),
est.se = mean(se, na.rm = T),
ci.cov = mean(ci.cov, na.rm = T))
tbl2 %>%
kable(format = "latex",
digits = 1,
align = c(rep("c", 2),
rep("r", 4)),
booktabs = TRUE,
linesep = c("", "", "", "\\addlinespace"),
escape = FALSE,
col.names = c("Estimator", "Correct Specifications",
"Bias", "ESE", "ASE", "Cov")) %>%
kable_styling("striped") %>%
row_spec(row = 0, bold = TRUE)
kbl2 <- tbl2 %>%
kable(format = "latex",
digits = 1,
align = c(rep("c", 2),
rep("r", 4)),
booktabs = TRUE,
linesep = c("", "", "", "\\addlinespace"),
escape = FALSE,
col.names = c("Estimator", "Correct Specifications",
"Bias", "ESE", "ASE", "Cov")) %>%
kable_styling("striped") %>%
row_spec(row = 0, bold = TRUE)
kbl2
tbl2 <- sim.out %>%
filter(type == "MCCS") %>%
mutate(Estimator = paste0("CS ", method)) %>%
group_by(spec, Estimator) %>%
summarise(bias = 100 * mean(est - g, na.rm = T),
emp.se = 100 * sd(est, na.rm = T),
est.se = 100 * mean(se, na.rm = T),
ci.cov = 100 * mean(ci.cov, na.rm = T))
kbl2
tbl2 <- sim.out %>%
filter(type == "MCCS") %>%
mutate(Estimator = paste0("CS ", method)) %>%
group_by(spec, Estimator) %>%
summarise(bias = 100 * mean(est - g, na.rm = T),
emp.se = 100 * sd(est, na.rm = T),
est.se = 100 * mean(se, na.rm = T),
ci.cov = 100 * mean(ci.cov, na.rm = T))
kbl
kbl2
tbl2 <- sim.out %>%
filter(type == "MCCS") %>%
mutate(Estimator = paste0("CS ", method)) %>%
group_by(spec, Estimator) %>%
summarise(bias = 100 * mean(est - g, na.rm = T),
emp.se = 100 * sd(est, na.rm = T),
est.se = 100 * mean(se, na.rm = T),
ci.cov = 100 * mean(ci.cov, na.rm = T))
kbl2 <- tbl2 %>%
kable(format = "latex",
digits = 1,
align = c(rep("c", 2),
rep("r", 4)),
booktabs = TRUE,
linesep = c("", "", "", "\\addlinespace"),
escape = FALSE,
col.names = c("Estimator", "Correct Specifications",
"Bias", "ESE", "ASE", "Cov")) %>%
kable_styling("striped") %>%
row_spec(row = 0, bold = TRUE)
kbl2
kbl2 <- tbl2 %>%
kable(format = "latex",
digits = 1,
align = c(rep("c", 2),
rep("r", 4)),
booktabs = TRUE,
linesep = c("", "", "\\addlinespace\\hline"),
escape = FALSE,
col.names = c("Estimator", "Correct Specifications",
"Bias", "ESE", "ASE", "Cov")) %>%
kable_styling("striped") %>%
row_spec(row = 0, bold = TRUE)
kbl2
kbl2 <- tbl2 %>%
kable(format = "latex",
digits = 1,
align = c(rep("c", 2),
rep("r", 4)),
booktabs = TRUE,
linesep = c("", "", "\\addlinespace\\hline"),
escape = FALSE,
col.names = c("Correct Specifications", "Estimator",
"Bias", "ESE", "ASE", "Cov")) %>%
kable_styling("striped") %>%
row_spec(row = 0, bold = TRUE)
kbl2
"DR CS")) %>%
tbl2 <- sim.out %>%
filter(type == "MCCS") %>%
mutate(Estimator = factor(paste0(gsub("Doubly Robust", "DR", method),
"CS "),
levels = c("G-Formula CS",
"IPW CS",
"DR CS"))) %>%
group_by(spec, Estimator) %>%
summarise(bias = 100 * mean(est - g, na.rm = T),
emp.se = 100 * sd(est, na.rm = T),
est.se = 100 * mean(se, na.rm = T),
ci.cov = 100 * mean(ci.cov, na.rm = T))
tbl2 <- sim.out %>%
filter(type == "MCCS") %>%
mutate(Estimator = factor(paste0(gsub("Doubly Robust", "DR", method),
" CS"),
levels = c("G-Formula CS",
"IPW CS",
"DR CS"))) %>%
group_by(spec, Estimator) %>%
summarise(bias = 100 * mean(est - g, na.rm = T),
emp.se = 100 * sd(est, na.rm = T),
est.se = 100 * mean(se, na.rm = T),
ci.cov = 100 * mean(ci.cov, na.rm = T))
kbl2 <- tbl2 %>%
kable(format = "latex",
digits = 1,
align = c(rep("c", 2),
rep("r", 4)),
booktabs = TRUE,
linesep = c("", "", "\\addlinespace\\hline"),
escape = FALSE,
col.names = c("Correct Specifications", "Estimator",
"Bias", "ESE", "ASE", "Cov")) %>%
kable_styling("striped") %>%
row_spec(row = 0, bold = TRUE)
kbl2
